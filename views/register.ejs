<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://kit.fontawesome.com/64d58efce2.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/toastify.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/toastify.min.js"></script>

    <link rel="stylesheet" href="css/style1.css" />

    <title>Sign in & Sign up Form</title>
  </head>
  <body>
    <!-- <%- include('header'); -%> -->
    <div class="container">
      <div class="forms-container">
        <div class="signin-signup">
          <form action="#" class="sign-up-form">
            <h2 class="title">Sign up</h2>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <input type="text" placeholder="fullname " id="signup-fullname" />
            </div>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <input type="text" placeholder="Username" id="signup-username" />
            </div>
            <div class="input-field">
              <i class="fas fa-envelope"></i>
              <input type="email" placeholder="Email" id="signup-email" />
            </div>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <select style="border: none" id="signup-user-type">
                <option style="border: none" value="user">User</option>
                <option style="border: none" value="teacher">Teacher</option>
              </select>
            </div>
            <div class="input-field">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                placeholder="Password"
                id="signup-password"
              />
            </div>
            <button type="submit" class="btn" value="Sign up" id="signup-btn">Sign Up</button>
            <p class="social-text">Or Sign up with social platforms</p>
            <div class="social-media">
              <a href="#" class="social-icon">
                <i class="fab fa-facebook-f"></i>
              </a>
              <a href="#" class="social-icon">
                <i class="fab fa-twitter"></i>
              </a>
              <a href="#" class="social-icon">
                <i class="fab fa-google"></i>
              </a>
              <a href="#" class="social-icon">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </div>
          </form>
          <form action="#" class="sign-in-form">
            <h2 class="title">Sign in</h2>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <input type="text" placeholder="Username" id="signin-username" />
            </div>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <select style="border: none" id="signin-user-type">
                <option style="border: none" value="user">User</option>
                <option style="border: none" value="teacher">Teacher</option>
              </select>
            </div>
            <div class="input-field">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                placeholder="Password"
                id="signin-password"
              />
            </div>
            <button type="submit" class="btn solid"  id="signin-btn">Login</button>
            <a href="forgotPassword" class="down" style="margin-left: 300px"
              >forgot Password</a
            >

            <p class="social-text">Or Sign in with social platforms</p>
            <div class="social-media">
              <a href="#" class="social-icon">
                <i class="fab fa-facebook-f"></i>
              </a>
              <a href="#" class="social-icon">
                <i class="fab fa-twitter"></i>
              </a>
              <a href="#" class="social-icon">
                <i class="fab fa-google"></i>
              </a>
              <a href="#" class="social-icon">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </div>
          </form>
        </div>
      </div>

      <div class="panels-container">
        <div class="panel left-panel">
          <div class="content">
            <h3>New here ?</h3>
            <p>
              Lorem ipsum, dolor sit amet consectetur adipisicing elit. Debitis,
              ex ratione. Aliquid!
            </p>
            <button class="btn transparent" id="sign-up-btn">Sign up</button>
          </div>
          <img src="img/log.svg" class="image" alt="" />
        </div>
        <div class="panel right-panel">
          <div class="content">
            <h3>One of us ?</h3>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Nostrum
              laboriosam ad deleniti.
            </p>
            <button class="btn transparent" id="sign-in-btn">Sign in</button>
          </div>
          <img src="img/register.svg" class="image" alt="" />
        </div>
      </div>
    </div>
    <%- include('footer'); -%>
    <script>
      Toastify({
        duration: 3000, // Set the duration for how long the toast will be displayed (in milliseconds)
        gravity: "top", // Position the toast at the top
        stopOnFocus: true, // Stop the timer when the toast is focused
        onClick: function () {}, // Handle click events on the toast (if needed)
      });
      const sign_in_btn = document.querySelector("#sign-in-btn");
      const sign_up_btn = document.querySelector("#sign-up-btn");
      const container = document.querySelector(".container");

      sign_up_btn.addEventListener("click", () => {
        container.classList.add("sign-up-mode");
      });

      sign_in_btn.addEventListener("click", () => {
        container.classList.remove("sign-up-mode");
      });
      document.querySelector("#signup-btn").addEventListener("click", () => {
        const usernameRegex = /^[a-zA-Z]+$/;
        const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        const passwordRegex = /^[A-Za-z\d]{8,}$/;
        const fullname = document.querySelector("#signup-fullname").value;
        const username = document.querySelector("#signup-username").value;
        const email = document.querySelector("#signup-email").value;
        const userType = document.querySelector("#signup-user-type").value;
        const password = document.querySelector("#signup-password").value;

        if (!username || !password || !fullname || !email || !userType ) {
          // Show an error toast if any field is empty
          Toastify({
            text: "Please fill in all fields",
            backgroundColor: "red",
          }).showToast();
          return;
        }


        if (!username.match(usernameRegex)) {
          
          Toastify({
                text: "Username should only contain letters (a-z, A-Z). ",
                backgroundColor: "red",
              }).showToast();
          return;
        }

        if (!email.match(emailRegex)) {
        
          Toastify({
                text: "Please enter a valid email address. ",
                backgroundColor: "red",
              }).showToast();
          return;
        }
        if (!password.match(passwordRegex)) {
        
        Toastify({
              text: "Please enter a Strong Password  ",
              backgroundColor: "red",
            }).showToast();
        return;
      }


        const data = {
          fullname: fullname,
          username: username,
          email: email,
          userType: userType,
          password: password,
        };
        console.log(data);

        fetch("http://localhost:8000/submit", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            if (response.ok) {
              // Handle successful registration here
              Toastify({
                text: "SignUp Successfully ",
                backgroundColor: "green",
              }).showToast();
              // sign_in_btn.addEventListener("click", () => {
                container.classList.remove("sign-up-mode");
          //  });
            } else {
              // Handle registration failure here

              Toastify({
                text: "Username is already Taken ",
                backgroundColor: "red",
              }).showToast();
            }
          })
          .catch((error) => {
            // Handle any errors that occur during the fetch
            Toastify({
              text: "Registration Failed ",
              backgroundColor: "red",
            }).showToast();
          });
      });
      document.querySelector("#signin-btn").addEventListener("click", () => {
        const username = document.querySelector("#signin-username").value;
        const password = document.querySelector("#signin-password").value;
        const userType = document.querySelector("#signin-user-type").value;
        const data = {
          username: username,
          password: password,
          userType : userType
        };
        console.log(data);
        fetch("http://localhost:8000/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            if (response.ok) {
              // Handle successful login here
              Toastify({
                text: "Login  Successfully ",
                backgroundColor: "green",
              }).showToast();
              window.location.href = "/homepage";

            } else {
              // Handle login failure here
              Toastify({
                text: "Invalid Credentials ",
                backgroundColor: "red",
              }).showToast();
              
            }
          })
          .catch((error) => {
            // Handle any errors that occur during the fetch
            console.error("Error:", error);
          });
      });
    </script>
  </body>
</html>
